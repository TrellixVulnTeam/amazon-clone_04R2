{"ast":null,"code":"import { __awaiter } from 'tslib';\nimport * as i0 from '@angular/core';\nimport { Injectable, NgModule } from '@angular/core';\nimport { HttpHeaders, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { Subject, from, combineLatest } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport Keycloak from 'keycloak-js';\nimport { CommonModule } from '@angular/common';\nvar KeycloakEventType;\n\n(function (KeycloakEventType) {\n  KeycloakEventType[KeycloakEventType[\"OnAuthError\"] = 0] = \"OnAuthError\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthLogout\"] = 1] = \"OnAuthLogout\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthRefreshError\"] = 2] = \"OnAuthRefreshError\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthRefreshSuccess\"] = 3] = \"OnAuthRefreshSuccess\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthSuccess\"] = 4] = \"OnAuthSuccess\";\n  KeycloakEventType[KeycloakEventType[\"OnReady\"] = 5] = \"OnReady\";\n  KeycloakEventType[KeycloakEventType[\"OnTokenExpired\"] = 6] = \"OnTokenExpired\";\n  KeycloakEventType[KeycloakEventType[\"OnActionUpdate\"] = 7] = \"OnActionUpdate\";\n})(KeycloakEventType || (KeycloakEventType = {}));\n\nclass KeycloakAuthGuard {\n  constructor(router, keycloakAngular) {\n    this.router = router;\n    this.keycloakAngular = keycloakAngular;\n  }\n\n  canActivate(route, state) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        this.authenticated = yield this.keycloakAngular.isLoggedIn();\n        this.roles = yield this.keycloakAngular.getUserRoles(true);\n        return yield this.isAccessAllowed(route, state);\n      } catch (error) {\n        throw new Error('An error happened during access validation. Details:' + error);\n      }\n    });\n  }\n\n}\n\nclass KeycloakService {\n  constructor() {\n    this._keycloakEvents$ = new Subject();\n  }\n\n  bindsKeycloakEvents() {\n    this._instance.onAuthError = errorData => {\n      this._keycloakEvents$.next({\n        args: errorData,\n        type: KeycloakEventType.OnAuthError\n      });\n    };\n\n    this._instance.onAuthLogout = () => {\n      this._keycloakEvents$.next({\n        type: KeycloakEventType.OnAuthLogout\n      });\n    };\n\n    this._instance.onAuthRefreshSuccess = () => {\n      this._keycloakEvents$.next({\n        type: KeycloakEventType.OnAuthRefreshSuccess\n      });\n    };\n\n    this._instance.onAuthRefreshError = () => {\n      this._keycloakEvents$.next({\n        type: KeycloakEventType.OnAuthRefreshError\n      });\n    };\n\n    this._instance.onAuthSuccess = () => {\n      this._keycloakEvents$.next({\n        type: KeycloakEventType.OnAuthSuccess\n      });\n    };\n\n    this._instance.onTokenExpired = () => {\n      this._keycloakEvents$.next({\n        type: KeycloakEventType.OnTokenExpired\n      });\n    };\n\n    this._instance.onActionUpdate = state => {\n      this._keycloakEvents$.next({\n        args: state,\n        type: KeycloakEventType.OnActionUpdate\n      });\n    };\n\n    this._instance.onReady = authenticated => {\n      this._keycloakEvents$.next({\n        args: authenticated,\n        type: KeycloakEventType.OnReady\n      });\n    };\n  }\n\n  loadExcludedUrls(bearerExcludedUrls) {\n    const excludedUrls = [];\n\n    for (const item of bearerExcludedUrls) {\n      let excludedUrl;\n\n      if (typeof item === 'string') {\n        excludedUrl = {\n          urlPattern: new RegExp(item, 'i'),\n          httpMethods: []\n        };\n      } else {\n        excludedUrl = {\n          urlPattern: new RegExp(item.url, 'i'),\n          httpMethods: item.httpMethods\n        };\n      }\n\n      excludedUrls.push(excludedUrl);\n    }\n\n    return excludedUrls;\n  }\n\n  initServiceValues({\n    enableBearerInterceptor = true,\n    loadUserProfileAtStartUp = false,\n    bearerExcludedUrls = [],\n    authorizationHeaderName = 'Authorization',\n    bearerPrefix = 'Bearer',\n    initOptions,\n    updateMinValidity = 20,\n    shouldAddToken = () => true,\n    shouldUpdateToken = () => true\n  }) {\n    this._enableBearerInterceptor = enableBearerInterceptor;\n    this._loadUserProfileAtStartUp = loadUserProfileAtStartUp;\n    this._authorizationHeaderName = authorizationHeaderName;\n    this._bearerPrefix = bearerPrefix.trim().concat(' ');\n    this._excludedUrls = this.loadExcludedUrls(bearerExcludedUrls);\n    this._silentRefresh = initOptions ? initOptions.flow === 'implicit' : false;\n    this._updateMinValidity = updateMinValidity;\n    this.shouldAddToken = shouldAddToken;\n    this.shouldUpdateToken = shouldUpdateToken;\n  }\n\n  init(options = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.initServiceValues(options);\n      const {\n        config,\n        initOptions\n      } = options;\n      this._instance = Keycloak(config);\n      this.bindsKeycloakEvents();\n      const authenticated = yield this._instance.init(initOptions);\n\n      if (authenticated && this._loadUserProfileAtStartUp) {\n        yield this.loadUserProfile();\n      }\n\n      return authenticated;\n    });\n  }\n\n  login(options = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this._instance.login(options);\n\n      if (this._loadUserProfileAtStartUp) {\n        yield this.loadUserProfile();\n      }\n    });\n  }\n\n  logout(redirectUri) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const options = {\n        redirectUri\n      };\n      yield this._instance.logout(options);\n      this._userProfile = undefined;\n    });\n  }\n\n  register(options = {\n    action: 'register'\n  }) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this._instance.register(options);\n    });\n  }\n\n  isUserInRole(role, resource) {\n    let hasRole;\n    hasRole = this._instance.hasResourceRole(role, resource);\n\n    if (!hasRole) {\n      hasRole = this._instance.hasRealmRole(role);\n    }\n\n    return hasRole;\n  }\n\n  getUserRoles(allRoles = true) {\n    let roles = [];\n\n    if (this._instance.resourceAccess) {\n      for (const key in this._instance.resourceAccess) {\n        if (this._instance.resourceAccess.hasOwnProperty(key)) {\n          const resourceAccess = this._instance.resourceAccess[key];\n          const clientRoles = resourceAccess['roles'] || [];\n          roles = roles.concat(clientRoles);\n        }\n      }\n    }\n\n    if (allRoles && this._instance.realmAccess) {\n      const realmRoles = this._instance.realmAccess['roles'] || [];\n      roles.push(...realmRoles);\n    }\n\n    return roles;\n  }\n\n  isLoggedIn() {\n    return __awaiter(this, void 0, void 0, function* () {\n      return yield this._instance.authenticated;\n    });\n  }\n\n  isTokenExpired(minValidity = 0) {\n    return this._instance.isTokenExpired(minValidity);\n  }\n\n  updateToken(minValidity = this._updateMinValidity) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        if (this._silentRefresh) {\n          if (this.isTokenExpired()) {\n            throw new Error('Failed to refresh the token, or the session is expired');\n          }\n\n          return true;\n        }\n\n        if (!this._instance) {\n          throw new Error('Keycloak Angular library is not initialized.');\n        }\n\n        return yield this._instance.updateToken(minValidity);\n      } catch (error) {\n        return false;\n      }\n    });\n  }\n\n  loadUserProfile(forceReload = false) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._userProfile && !forceReload) {\n        return this._userProfile;\n      }\n\n      if (!this._instance.authenticated) {\n        throw new Error('The user profile was not loaded as the user is not logged in.');\n      }\n\n      return this._userProfile = yield this._instance.loadUserProfile();\n    });\n  }\n\n  getToken() {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._instance.token;\n    });\n  }\n\n  getUsername() {\n    if (!this._userProfile) {\n      throw new Error('User not logged in or user profile was not loaded.');\n    }\n\n    return this._userProfile.username;\n  }\n\n  clearToken() {\n    this._instance.clearToken();\n  }\n\n  addTokenToHeader(headers = new HttpHeaders()) {\n    return from(this.getToken()).pipe(map(token => token ? headers.set(this._authorizationHeaderName, this._bearerPrefix + token) : headers));\n  }\n\n  getKeycloakInstance() {\n    return this._instance;\n  }\n\n  get excludedUrls() {\n    return this._excludedUrls;\n  }\n\n  get enableBearerInterceptor() {\n    return this._enableBearerInterceptor;\n  }\n\n  get keycloakEvents$() {\n    return this._keycloakEvents$;\n  }\n\n}\n\nKeycloakService.ɵfac = function KeycloakService_Factory(t) {\n  return new (t || KeycloakService)();\n};\n\nKeycloakService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: KeycloakService,\n  factory: KeycloakService.ɵfac\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(KeycloakService, [{\n    type: Injectable\n  }], null, null);\n})();\n\nclass KeycloakBearerInterceptor {\n  constructor(keycloak) {\n    this.keycloak = keycloak;\n  }\n\n  conditionallyUpdateToken(req) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.keycloak.shouldUpdateToken(req)) {\n        return yield this.keycloak.updateToken();\n      }\n\n      return true;\n    });\n  }\n\n  isUrlExcluded({\n    method,\n    url\n  }, {\n    urlPattern,\n    httpMethods\n  }) {\n    const httpTest = httpMethods.length === 0 || httpMethods.join().indexOf(method.toUpperCase()) > -1;\n    const urlTest = urlPattern.test(url);\n    return httpTest && urlTest;\n  }\n\n  intercept(req, next) {\n    const {\n      enableBearerInterceptor,\n      excludedUrls\n    } = this.keycloak;\n\n    if (!enableBearerInterceptor) {\n      return next.handle(req);\n    }\n\n    const shallPass = !this.keycloak.shouldAddToken(req) || excludedUrls.findIndex(item => this.isUrlExcluded(req, item)) > -1;\n\n    if (shallPass) {\n      return next.handle(req);\n    }\n\n    return combineLatest([this.conditionallyUpdateToken(req), this.keycloak.isLoggedIn()]).pipe(mergeMap(([_, isLoggedIn]) => isLoggedIn ? this.handleRequestWithTokenHeader(req, next) : next.handle(req)));\n  }\n\n  handleRequestWithTokenHeader(req, next) {\n    return this.keycloak.addTokenToHeader(req.headers).pipe(mergeMap(headersWithBearer => {\n      const kcReq = req.clone({\n        headers: headersWithBearer\n      });\n      return next.handle(kcReq);\n    }));\n  }\n\n}\n\nKeycloakBearerInterceptor.ɵfac = function KeycloakBearerInterceptor_Factory(t) {\n  return new (t || KeycloakBearerInterceptor)(i0.ɵɵinject(KeycloakService));\n};\n\nKeycloakBearerInterceptor.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: KeycloakBearerInterceptor,\n  factory: KeycloakBearerInterceptor.ɵfac\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(KeycloakBearerInterceptor, [{\n    type: Injectable\n  }], function () {\n    return [{\n      type: KeycloakService\n    }];\n  }, null);\n})();\n\nclass CoreModule {}\n\nCoreModule.ɵfac = function CoreModule_Factory(t) {\n  return new (t || CoreModule)();\n};\n\nCoreModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n  type: CoreModule\n});\nCoreModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n  providers: [KeycloakService, {\n    provide: HTTP_INTERCEPTORS,\n    useClass: KeycloakBearerInterceptor,\n    multi: true\n  }],\n  imports: [[CommonModule]]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(CoreModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CommonModule],\n      providers: [KeycloakService, {\n        provide: HTTP_INTERCEPTORS,\n        useClass: KeycloakBearerInterceptor,\n        multi: true\n      }]\n    }]\n  }], null, null);\n})();\n\nclass KeycloakAngularModule {}\n\nKeycloakAngularModule.ɵfac = function KeycloakAngularModule_Factory(t) {\n  return new (t || KeycloakAngularModule)();\n};\n\nKeycloakAngularModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n  type: KeycloakAngularModule\n});\nKeycloakAngularModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n  imports: [[CoreModule]]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(KeycloakAngularModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CoreModule]\n    }]\n  }], null, null);\n})();\n\nexport { CoreModule, KeycloakAngularModule, KeycloakAuthGuard, KeycloakBearerInterceptor, KeycloakEventType, KeycloakService };","map":{"version":3,"sources":["C:/Users/vacca/OneDrive/Desktop/amazon-clone-2508e498a694f9a00f7c2f4d72fbb896c9913743/frontend/node_modules/keycloak-angular/fesm2015/keycloak-angular.mjs"],"names":["__awaiter","i0","Injectable","NgModule","HttpHeaders","HTTP_INTERCEPTORS","Subject","from","combineLatest","map","mergeMap","Keycloak","CommonModule","KeycloakEventType","KeycloakAuthGuard","constructor","router","keycloakAngular","canActivate","route","state","authenticated","isLoggedIn","roles","getUserRoles","isAccessAllowed","error","Error","KeycloakService","_keycloakEvents$","bindsKeycloakEvents","_instance","onAuthError","errorData","next","args","type","OnAuthError","onAuthLogout","OnAuthLogout","onAuthRefreshSuccess","OnAuthRefreshSuccess","onAuthRefreshError","OnAuthRefreshError","onAuthSuccess","OnAuthSuccess","onTokenExpired","OnTokenExpired","onActionUpdate","OnActionUpdate","onReady","OnReady","loadExcludedUrls","bearerExcludedUrls","excludedUrls","item","excludedUrl","urlPattern","RegExp","httpMethods","url","push","initServiceValues","enableBearerInterceptor","loadUserProfileAtStartUp","authorizationHeaderName","bearerPrefix","initOptions","updateMinValidity","shouldAddToken","shouldUpdateToken","_enableBearerInterceptor","_loadUserProfileAtStartUp","_authorizationHeaderName","_bearerPrefix","trim","concat","_excludedUrls","_silentRefresh","flow","_updateMinValidity","init","options","config","loadUserProfile","login","logout","redirectUri","_userProfile","undefined","register","action","isUserInRole","role","resource","hasRole","hasResourceRole","hasRealmRole","allRoles","resourceAccess","key","hasOwnProperty","clientRoles","realmAccess","realmRoles","isTokenExpired","minValidity","updateToken","forceReload","getToken","token","getUsername","username","clearToken","addTokenToHeader","headers","pipe","set","getKeycloakInstance","keycloakEvents$","ɵfac","ɵprov","KeycloakBearerInterceptor","keycloak","conditionallyUpdateToken","req","isUrlExcluded","method","httpTest","length","join","indexOf","toUpperCase","urlTest","test","intercept","handle","shallPass","findIndex","_","handleRequestWithTokenHeader","headersWithBearer","kcReq","clone","CoreModule","ɵmod","ɵinj","provide","useClass","multi","imports","providers","KeycloakAngularModule"],"mappings":"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","sourcesContent":["import { __awaiter } from 'tslib';\nimport * as i0 from '@angular/core';\nimport { Injectable, NgModule } from '@angular/core';\nimport { HttpHeaders, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { Subject, from, combineLatest } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport Keycloak from 'keycloak-js';\nimport { CommonModule } from '@angular/common';\n\nvar KeycloakEventType;\n(function (KeycloakEventType) {\n    KeycloakEventType[KeycloakEventType[\"OnAuthError\"] = 0] = \"OnAuthError\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthLogout\"] = 1] = \"OnAuthLogout\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthRefreshError\"] = 2] = \"OnAuthRefreshError\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthRefreshSuccess\"] = 3] = \"OnAuthRefreshSuccess\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthSuccess\"] = 4] = \"OnAuthSuccess\";\n    KeycloakEventType[KeycloakEventType[\"OnReady\"] = 5] = \"OnReady\";\n    KeycloakEventType[KeycloakEventType[\"OnTokenExpired\"] = 6] = \"OnTokenExpired\";\n    KeycloakEventType[KeycloakEventType[\"OnActionUpdate\"] = 7] = \"OnActionUpdate\";\n})(KeycloakEventType || (KeycloakEventType = {}));\n\nclass KeycloakAuthGuard {\n    constructor(router, keycloakAngular) {\n        this.router = router;\n        this.keycloakAngular = keycloakAngular;\n    }\n    canActivate(route, state) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                this.authenticated = yield this.keycloakAngular.isLoggedIn();\n                this.roles = yield this.keycloakAngular.getUserRoles(true);\n                return yield this.isAccessAllowed(route, state);\n            }\n            catch (error) {\n                throw new Error('An error happened during access validation. Details:' + error);\n            }\n        });\n    }\n}\n\nclass KeycloakService {\n    constructor() {\n        this._keycloakEvents$ = new Subject();\n    }\n    bindsKeycloakEvents() {\n        this._instance.onAuthError = (errorData) => {\n            this._keycloakEvents$.next({\n                args: errorData,\n                type: KeycloakEventType.OnAuthError\n            });\n        };\n        this._instance.onAuthLogout = () => {\n            this._keycloakEvents$.next({ type: KeycloakEventType.OnAuthLogout });\n        };\n        this._instance.onAuthRefreshSuccess = () => {\n            this._keycloakEvents$.next({\n                type: KeycloakEventType.OnAuthRefreshSuccess\n            });\n        };\n        this._instance.onAuthRefreshError = () => {\n            this._keycloakEvents$.next({\n                type: KeycloakEventType.OnAuthRefreshError\n            });\n        };\n        this._instance.onAuthSuccess = () => {\n            this._keycloakEvents$.next({ type: KeycloakEventType.OnAuthSuccess });\n        };\n        this._instance.onTokenExpired = () => {\n            this._keycloakEvents$.next({\n                type: KeycloakEventType.OnTokenExpired\n            });\n        };\n        this._instance.onActionUpdate = (state) => {\n            this._keycloakEvents$.next({\n                args: state,\n                type: KeycloakEventType.OnActionUpdate\n            });\n        };\n        this._instance.onReady = (authenticated) => {\n            this._keycloakEvents$.next({\n                args: authenticated,\n                type: KeycloakEventType.OnReady\n            });\n        };\n    }\n    loadExcludedUrls(bearerExcludedUrls) {\n        const excludedUrls = [];\n        for (const item of bearerExcludedUrls) {\n            let excludedUrl;\n            if (typeof item === 'string') {\n                excludedUrl = { urlPattern: new RegExp(item, 'i'), httpMethods: [] };\n            }\n            else {\n                excludedUrl = {\n                    urlPattern: new RegExp(item.url, 'i'),\n                    httpMethods: item.httpMethods\n                };\n            }\n            excludedUrls.push(excludedUrl);\n        }\n        return excludedUrls;\n    }\n    initServiceValues({ enableBearerInterceptor = true, loadUserProfileAtStartUp = false, bearerExcludedUrls = [], authorizationHeaderName = 'Authorization', bearerPrefix = 'Bearer', initOptions, updateMinValidity = 20, shouldAddToken = () => true, shouldUpdateToken = () => true }) {\n        this._enableBearerInterceptor = enableBearerInterceptor;\n        this._loadUserProfileAtStartUp = loadUserProfileAtStartUp;\n        this._authorizationHeaderName = authorizationHeaderName;\n        this._bearerPrefix = bearerPrefix.trim().concat(' ');\n        this._excludedUrls = this.loadExcludedUrls(bearerExcludedUrls);\n        this._silentRefresh = initOptions ? initOptions.flow === 'implicit' : false;\n        this._updateMinValidity = updateMinValidity;\n        this.shouldAddToken = shouldAddToken;\n        this.shouldUpdateToken = shouldUpdateToken;\n    }\n    init(options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.initServiceValues(options);\n            const { config, initOptions } = options;\n            this._instance = Keycloak(config);\n            this.bindsKeycloakEvents();\n            const authenticated = yield this._instance.init(initOptions);\n            if (authenticated && this._loadUserProfileAtStartUp) {\n                yield this.loadUserProfile();\n            }\n            return authenticated;\n        });\n    }\n    login(options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this._instance.login(options);\n            if (this._loadUserProfileAtStartUp) {\n                yield this.loadUserProfile();\n            }\n        });\n    }\n    logout(redirectUri) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const options = {\n                redirectUri\n            };\n            yield this._instance.logout(options);\n            this._userProfile = undefined;\n        });\n    }\n    register(options = { action: 'register' }) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this._instance.register(options);\n        });\n    }\n    isUserInRole(role, resource) {\n        let hasRole;\n        hasRole = this._instance.hasResourceRole(role, resource);\n        if (!hasRole) {\n            hasRole = this._instance.hasRealmRole(role);\n        }\n        return hasRole;\n    }\n    getUserRoles(allRoles = true) {\n        let roles = [];\n        if (this._instance.resourceAccess) {\n            for (const key in this._instance.resourceAccess) {\n                if (this._instance.resourceAccess.hasOwnProperty(key)) {\n                    const resourceAccess = this._instance.resourceAccess[key];\n                    const clientRoles = resourceAccess['roles'] || [];\n                    roles = roles.concat(clientRoles);\n                }\n            }\n        }\n        if (allRoles && this._instance.realmAccess) {\n            const realmRoles = this._instance.realmAccess['roles'] || [];\n            roles.push(...realmRoles);\n        }\n        return roles;\n    }\n    isLoggedIn() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return yield this._instance.authenticated;\n        });\n    }\n    isTokenExpired(minValidity = 0) {\n        return this._instance.isTokenExpired(minValidity);\n    }\n    updateToken(minValidity = this._updateMinValidity) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                if (this._silentRefresh) {\n                    if (this.isTokenExpired()) {\n                        throw new Error('Failed to refresh the token, or the session is expired');\n                    }\n                    return true;\n                }\n                if (!this._instance) {\n                    throw new Error('Keycloak Angular library is not initialized.');\n                }\n                return yield this._instance.updateToken(minValidity);\n            }\n            catch (error) {\n                return false;\n            }\n        });\n    }\n    loadUserProfile(forceReload = false) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._userProfile && !forceReload) {\n                return this._userProfile;\n            }\n            if (!this._instance.authenticated) {\n                throw new Error('The user profile was not loaded as the user is not logged in.');\n            }\n            return (this._userProfile = yield this._instance.loadUserProfile());\n        });\n    }\n    getToken() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this._instance.token;\n        });\n    }\n    getUsername() {\n        if (!this._userProfile) {\n            throw new Error('User not logged in or user profile was not loaded.');\n        }\n        return this._userProfile.username;\n    }\n    clearToken() {\n        this._instance.clearToken();\n    }\n    addTokenToHeader(headers = new HttpHeaders()) {\n        return from(this.getToken()).pipe(map((token) => token\n            ? headers.set(this._authorizationHeaderName, this._bearerPrefix + token)\n            : headers));\n    }\n    getKeycloakInstance() {\n        return this._instance;\n    }\n    get excludedUrls() {\n        return this._excludedUrls;\n    }\n    get enableBearerInterceptor() {\n        return this._enableBearerInterceptor;\n    }\n    get keycloakEvents$() {\n        return this._keycloakEvents$;\n    }\n}\nKeycloakService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });\nKeycloakService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakService });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakService, decorators: [{\n            type: Injectable\n        }] });\n\nclass KeycloakBearerInterceptor {\n    constructor(keycloak) {\n        this.keycloak = keycloak;\n    }\n    conditionallyUpdateToken(req) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.keycloak.shouldUpdateToken(req)) {\n                return yield this.keycloak.updateToken();\n            }\n            return true;\n        });\n    }\n    isUrlExcluded({ method, url }, { urlPattern, httpMethods }) {\n        const httpTest = httpMethods.length === 0 ||\n            httpMethods.join().indexOf(method.toUpperCase()) > -1;\n        const urlTest = urlPattern.test(url);\n        return httpTest && urlTest;\n    }\n    intercept(req, next) {\n        const { enableBearerInterceptor, excludedUrls } = this.keycloak;\n        if (!enableBearerInterceptor) {\n            return next.handle(req);\n        }\n        const shallPass = !this.keycloak.shouldAddToken(req) ||\n            excludedUrls.findIndex((item) => this.isUrlExcluded(req, item)) > -1;\n        if (shallPass) {\n            return next.handle(req);\n        }\n        return combineLatest([\n            this.conditionallyUpdateToken(req),\n            this.keycloak.isLoggedIn()\n        ]).pipe(mergeMap(([_, isLoggedIn]) => isLoggedIn\n            ? this.handleRequestWithTokenHeader(req, next)\n            : next.handle(req)));\n    }\n    handleRequestWithTokenHeader(req, next) {\n        return this.keycloak.addTokenToHeader(req.headers).pipe(mergeMap((headersWithBearer) => {\n            const kcReq = req.clone({ headers: headersWithBearer });\n            return next.handle(kcReq);\n        }));\n    }\n}\nKeycloakBearerInterceptor.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakBearerInterceptor, deps: [{ token: KeycloakService }], target: i0.ɵɵFactoryTarget.Injectable });\nKeycloakBearerInterceptor.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakBearerInterceptor });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakBearerInterceptor, decorators: [{\n            type: Injectable\n        }], ctorParameters: function () { return [{ type: KeycloakService }]; } });\n\nclass CoreModule {\n}\nCoreModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: CoreModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\nCoreModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: CoreModule, imports: [CommonModule] });\nCoreModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: CoreModule, providers: [\n        KeycloakService,\n        {\n            provide: HTTP_INTERCEPTORS,\n            useClass: KeycloakBearerInterceptor,\n            multi: true\n        }\n    ], imports: [[CommonModule]] });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: CoreModule, decorators: [{\n            type: NgModule,\n            args: [{\n                    imports: [CommonModule],\n                    providers: [\n                        KeycloakService,\n                        {\n                            provide: HTTP_INTERCEPTORS,\n                            useClass: KeycloakBearerInterceptor,\n                            multi: true\n                        }\n                    ]\n                }]\n        }] });\n\nclass KeycloakAngularModule {\n}\nKeycloakAngularModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakAngularModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\nKeycloakAngularModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakAngularModule, imports: [CoreModule] });\nKeycloakAngularModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakAngularModule, imports: [[CoreModule]] });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.3.1\", ngImport: i0, type: KeycloakAngularModule, decorators: [{\n            type: NgModule,\n            args: [{\n                    imports: [CoreModule]\n                }]\n        }] });\n\nexport { CoreModule, KeycloakAngularModule, KeycloakAuthGuard, KeycloakBearerInterceptor, KeycloakEventType, KeycloakService };\n"]},"metadata":{},"sourceType":"module"}